pkgname=postmarketos-android-recovery-installer
pkgver=0.1.0
pkgrel=0
pkgdesc="TWRP compatible postmarketOS installer script"
url="https://github.com/postmarketOS"
# multipath-tools: kpartx
depends="busybox-extras lddtree cryptsetup multipath-tools device-mapper parted util-linux zip e2fsprogs tar"
source="build_zip.sh
	update-binary
	pmos_chroot
	pmos_install
	pmos_install_functions
	pmos_setpw"
arch="noarch"
license="GPL3"

package() {
	install -Dm755 "$srcdir/build_zip.sh" \
		"$pkgdir/sbin/build-recovery-zip"
	mkdir -p "$pkgdir/var/lib/postmarketos-android-recovery-installer/META-INF/com/google/android/"
	install -Dm644 "$srcdir"/update-binary \
		"$pkgdir/var/lib/postmarketos-android-recovery-installer/META-INF/com/google/android/update-binary"
	install -Dm755 "$srcdir"/pmos_chroot \
		"$pkgdir/var/lib/postmarketos-android-recovery-installer/pmos_chroot"
	mkdir -p "$pkgdir/var/lib/postmarketos-android-recovery-installer/chroot/bin/"
	for file in pmos_install pmos_install_functions pmos_setpw; do
		install -Dm755 "$srcdir/$file" \
			"$pkgdir/var/lib/postmarketos-android-recovery-installer/chroot/bin/$file"
	done
	mkdir -p "$pkgdir/var/lib/postmarketos-android-recovery-installer/chroot/lib/"
}
sha512sums="8af2e513fd8bdbc9d8e3d84298e81e8793f386b8fbfb7de19759d2fc2790fc3ead83ab17aea597e134338383830b7eb0bbd23cc244b3491a29f2c969b7433ac7  build_zip.sh
1f9656d76deb523104b4ad6aa8ceca10028a0757514c3123d0343b96e0f350772fca8f4e934ce53e0a784d9669c816d49ba8c152d3484d4d7b98a68c763a0bfb  update-binary
7292cd8476c267d3cefdb4d6675f926aa80cec98d42ba459427aaca9157440339a959eb143a4e628d7d05e596d011856d4f60b6eaa2d175c6ef29a21c9bd4088  pmos_chroot
1c539306f53861bde41690a59b770236d194f98d2a59c301f3b9cc8ae3064e37e242bc825cfd0c23f1584850a12db4ed0d20675cf1cd5a4905ac2de157c055ba  pmos_install
a528d1ec26b0bd8fbde418362593efda3cf4cc7259c90cccc9eab2c57e3437150c4b97ddde59182c01a60a22351912bbf5320674afd40b0bfae0ccf3cd2469e7  pmos_install_functions
27dd89aa8471349995a1cbbc1034ead662a0d1dd70ca5490f3191ceaaeb853331003c20ffddbbd95fe822135a85c1beb1e2a32bb33b10c2a4177b30347a40555  pmos_setpw"
